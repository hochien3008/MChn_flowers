# ============================================
# Apache Configuration for Sweetie Garden
# MERGED & OPTIMIZED VERSION
# ============================================

# Enable Rewrite Engine
<IfModule mod_rewrite.c>
    RewriteEngine On
    RewriteBase /
    
    # Remove .html extension
    RewriteCond %{REQUEST_FILENAME} !-f
    RewriteCond %{REQUEST_FILENAME} !-d
    RewriteRule ^([^\.]+)$ $1.html [NC,L]
    
    # API Routes
    RewriteRule ^api/(.*)$ api/$1 [L]
    
    # Block access to sensitive files
    RewriteRule ^(config|database|\.git|node_modules|STRUCTURE\.md|README\.md|composer\.json|package\.json|\.env) - [F,L]
</IfModule>

# Security Headers
<IfModule mod_headers.c>
    Header set X-Content-Type-Options "nosniff"
    Header set X-Frame-Options "SAMEORIGIN"
    Header set X-XSS-Protection "1; mode=block"
    Header set Referrer-Policy "strict-origin-when-cross-origin"
</IfModule>

# Prevent directory listing
Options -Indexes

# Custom Error Pages
ErrorDocument 404 /404.html
ErrorDocument 500 /500.html

# File Upload Limits
<IfModule mod_php7.c>
    php_value upload_max_filesize 10M
    php_value post_max_size 10M
    php_value max_execution_time 300
    php_value max_input_time 300
</IfModule>

# Compression
<IfModule mod_deflate.c>
    AddOutputFilterByType DEFLATE text/html text/plain text/xml text/css text/javascript application/javascript application/json
</IfModule>

# ============================================
# CACHE CONTROL - OPTIMIZED FOR UPDATES
# ============================================
<IfModule mod_headers.c>
    # 1. HTML/PHP: NO CACHE (Khắc phục lỗi sửa xong không hiện)
    <FilesMatch "\.(html|php)$">
        Header set Cache-Control "no-cache, no-store, must-revalidate"
        Header set Pragma "no-cache"
        Header set Expires 0
    </FilesMatch>

    # 2. CSS/JS: Cache 1 tuần (để tải nhanh) nhưng kiểm tra lại nếu tên file đổi
    <FilesMatch "\.(css|js)$">
        Header set Cache-Control "max-age=604800, public"
    </FilesMatch>
    
    # 3. Images: Cache 1 tháng (vì ít thay đổi)
    <FilesMatch "\.(jpg|jpeg|png|gif|webp|svg)$">
        Header set Cache-Control "max-age=2592000, public"
    </FilesMatch>
</IfModule>

# MIME Types
<IfModule mod_mime.c>
    AddType image/webp .webp
    AddType application/javascript .js
    AddType text/css .css
</IfModule>

# php -- BEGIN cPanel-generated handler, do not edit
<IfModule mime_module>
  AddHandler application/x-httpd-ea-php83 .php .php8 .phtml
</IfModule>
# php -- END cPanel-generated handler, do not edit
